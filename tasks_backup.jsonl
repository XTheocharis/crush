{"id": "134", "subject": "[P0-02] Wire config fields/defaults", "description": "Repo: /home/user/working/crush. Spec: Phase 0A + Critical files reference. Modify internal/config/config.go to add Options.RepoMap field and merge delegation in Options.merge(); modify internal/config/load.go setDefaults() to initialize RepoMap defaults when nil. Preserve existing merge patterns and minimal upstream diff style. Do not add unrelated refactors. Verification: `go test ./internal/config -run TestConfigMerging`. Subagent prompt: 'Implement P0-02 with minimal changes to config.go/load.go, matching plan merge/default semantics. Return exact diffs and test output.'", "status": "pending", "blockedBy": ["136"], "blocks": ["139", "143", "144"]}
{"id": "135", "subject": "[P0-05] Add sqlc repo_map queries", "description": "Repo: /home/user/working/crush. Spec: Phase 0A sqlc query list. Create internal/db/sql/repo_map.sql with upsert/list/delete queries for file cache, tags, session rankings, and session read-only paths. Then run `task sqlc` and commit generated db code changes. Ensure query names/params mirror plan contracts (including DeleteSessionReadOnlyPaths). Verification: `task sqlc && go test ./internal/db/...`. Subagent prompt: 'Implement repo_map.sql query file, regenerate sqlc, fix compile issues from generated API surfaces, and report generated file list.'", "status": "pending", "blockedBy": ["137"], "blocks": ["143", "144"]}
{"id": "136", "subject": "[P0-01] Add RepoMapOptions model", "description": "Repo: /home/user/working/crush. Spec: docs/PLAN-treesitter-repomap.md Phase 0A. Create internal/config/repomap.go with RepoMapOptions, DefaultRepoMapOptions(), DefaultRepoMapMaxTokens(), and RepoMapOptions.merge() rules exactly as plan states: Disabled OR-latch, MaxTokens last-non-zero, ExcludeGlobs append+dedup, RefreshMode last-non-empty, MapMulNoFiles non-zero override. Include JSON tags and jsonschema descriptions. Keep behavior default-enabled via options object. Verification for this task: `go test ./internal/config -run TestConfigMerging` must compile (tests added in P0-03). Subagent prompt: 'Implement P0-01 exactly as specified in this task. Focus only on internal/config/repomap.go and required compile-safe wiring helpers in that file. Return changed files and rationale.'", "status": "pending", "blockedBy": [], "blocks": ["139", "134", "144"]}
{"id": "137", "subject": "[P0-04] Add repo_map migration", "description": "Repo: /home/user/working/crush. Spec: Phase 0A migration contract. Create internal/db/migrations/20260222000000_repo_map.sql with up/down for tables/indexes: repo_map_file_cache, repo_map_tags, repo_map_session_rankings, repo_map_session_read_only, including FK and indexes from plan. Keep repo_key + rel_path scoping and ON DELETE CASCADE behavior. Verification: `go test ./internal/db/...` (and migration compile if project has migration tests). Subagent prompt: 'Implement migration exactly per task schema contract, including down migration cleanup of indexes/tables in reverse-safe order.'", "status": "pending", "blockedBy": [], "blocks": ["135", "144"]}
{"id": "138", "subject": "[P0-06] Add treesitter public types", "description": "Repo: /home/user/working/crush. Spec: Phase 0B. Create internal/treesitter/treesitter.go with Tag, SymbolInfo, FileAnalysis, ImportInfo, Parser interface, and Tag.String() stable format `<rel_path>:<line> <kind> <name> [<node_type>]`. Keep package compile-only (no CGO parser implementation here). Verification: `go test ./internal/treesitter/...` should compile once tests in P0-07 are added. Subagent prompt: 'Implement types and interfaces only, matching field names/contracts from plan, no parser logic yet.'", "status": "pending", "blockedBy": [], "blocks": ["141", "144"]}
{"id": "139", "subject": "[P0-03] Add config merge tests", "description": "Repo: /home/user/working/crush. Spec: Phase 0A verification + merge-rule details. Update internal/config/merge_test.go (and any nearby config tests) to assert RepoMap merge behavior for Disabled, MaxTokens, ExcludeGlobs dedup, RefreshMode, MapMulNoFiles, and default initialization path. Include cases proving lower-priority configs cannot re-enable Disabled after true. Verification: `go test ./internal/config/... -run TestConfigMerging`. Subagent prompt: 'Implement tests for RepoMap merge/default semantics only; avoid unrelated test churn. Return new test cases and outputs.'", "status": "pending", "blockedBy": ["136", "134"], "blocks": ["144"]}
{"id": "140", "subject": "[P0-08] Add blocker scaffolds", "description": "Repo: /home/user/working/crush. Spec: Phase 0C blocker gate requirements #1/#2. Create compilable scaffolds for internal/treesitter/parser.go, internal/treesitter/query.go, internal/treesitter/cache.go, and internal/repomap/repomap.go (service skeleton + GenerateOpts + no-op methods). Goal is unblock 1A/2A/3A.0 with compilable package surfaces. Verification: `go test ./...` should compile for new packages (feature logic can be stubbed). Subagent prompt: 'Create compile-safe scaffolds only; preserve future API names/signatures from plan to avoid later churn.'", "status": "pending", "blockedBy": [], "blocks": ["143", "144"]}
{"id": "141", "subject": "[P0-07] Add treesitter type tests", "description": "Repo: /home/user/working/crush. Spec: Phase 0B testing section. Add internal/treesitter/treesitter_test.go with TestTagString, TestSymbolInfoFields, TestImportCategoryValues (or equivalent names) covering string format and category constants. Verification: `go test ./internal/treesitter/...`. Subagent prompt: 'Add focused unit tests for treesitter public types contracts; keep tests deterministic and minimal.'", "status": "pending", "blockedBy": ["138"], "blocks": ["144", "251"]}
{"id": "142", "subject": "[P0-10] Add bootstrap persistence tests", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 0C requirements #4/#5. Files: add tests in /home/user/working/crush/internal/lcm/message_decorator_test.go and fixtures in /home/user/working/crush/internal/lcm/testdata/ (create only if needed). Acceptance: prove persisted vs non-persisted matrix for bootstrap path, explicit null vs non-null exploration fields, and non-blocking failure behavior under config gates. Verification: `go test ./internal/lcm/... -run Bootstrap|Exploration|LargeToolOutput` then `go test ./internal/lcm/...`. Subagent prompt (exact): \"Add Phase 0C bootstrap persistence tests with persisted/non-persisted and failure-path assertions, then run lcm tests.\"", "status": "pending", "blockedBy": ["143"], "blocks": ["144"]}
{"id": "143", "subject": "[P0-09] Wire bootstrap persistence path", "description": "Repo: /home/user/working/crush. Spec: Phase 0C requirement #3 and Phase 2D runtime wiring requirement. Modify internal/lcm/message_decorator.go so large tool-output path runs exploration runtime after InsertLargeTextContent and persists exploration_summary/explorer_used via UpdateLcmLargeFileExploration, while honoring DisableLargeToolOutput and LargeToolOutputTokenThreshold gates. Failure must be non-blocking and preserve existing flow. Verification: targeted tests in P0-10 + `go test ./internal/lcm/...`. Subagent prompt: 'Implement bootstrap runtime persistence with conservative failure behavior and config-gated interception; avoid broad refactors.'", "status": "pending", "blockedBy": ["140", "135", "134"], "blocks": ["144", "142"]}
{"id": "144", "subject": "[P0-GATE] Verify Phase 0 completion", "description": "Gate task. Repo: /home/user/working/crush. Preconditions: P0-01..P0-10 complete. Execute and capture evidence for Phase 0 requirements (0A/0B/0C). Verification commands: `go test ./internal/config/... -run TestConfigMerging`, `task sqlc`, `go test ./internal/db/...`, `go test ./internal/treesitter/...`, `go test ./internal/lcm/...` for bootstrap tests. Produce a short artifact summary in task completion comment: changed files, tests run, and pass/fail. Subagent prompt: 'Run Phase 0 verification suite, fix failing Phase 0 items only, and report evidence that all 0A/0B/0C criteria are satisfied.'", "status": "pending", "blockedBy": ["136", "134", "139", "137", "135", "138", "141", "140", "143", "142"], "blocks": ["145", "228", "156", "250"]}
{"id": "145", "subject": "[P1-01] Add bootstrap TS deps/embed", "description": "Repo: /home/user/working/crush. Spec: Phase 1A dependencies and embed contract. Add go-tree-sitter + bootstrap grammars (go/python), add initial queries directory and embed directives for queries/* and languages.json. Include minimal languages.json bootstrap entries. Verification: `go test ./internal/treesitter/...` compiles with new deps. Subagent prompt: 'Add bootstrap tree-sitter deps and embed assets exactly for Go/Python startup path with compile-safe wiring.'", "status": "pending", "blockedBy": ["144"], "blocks": ["148", "146", "153", "156"]}
{"id": "146", "subject": "[P1-02] Implement parser lifecycle core", "description": "Repo: /home/user/working/crush. Spec: docs/PLAN-treesitter-repomap.md Phase 1A parser.go lifecycle contract. Implement Acquire/Release/Close semantics with cancellation-safe pool behavior, per-call QueryCursor ownership, and non-deadlocking shutdown. Files: internal/treesitter/parser.go (+ helper files if needed). Do not implement full language expansion yet. Verification: add/adjust unit tests and run `go test ./internal/treesitter/...`. Subagent prompt: 'Implement parser pool lifecycle contract exactly as task states, with focus on deadlock-safe shutdown and context cancellation propagation.'", "status": "pending", "blockedBy": ["145"], "blocks": ["152", "156"]}
{"id": "147", "subject": "[P1-05] Add bootstrap parser tests", "description": "Repo: /home/user/working/crush. Spec: Phase 1A testing bullets. Add tests for Go/Python parse/tag extraction counts and names, capture mapping (@name.definition.* -> def, @name.reference.* -> ref), SymbolInfo extraction basics, and custom predicate tolerance (#strip!, #set-adjacent!). Files: internal/treesitter/*_test.go. Verification: `go test ./internal/treesitter/...`. Subagent prompt: 'Create deterministic bootstrap parser tests covering capture mapping and predicate tolerance for Go/Python.'", "status": "pending", "blockedBy": ["152"], "blocks": ["155", "151", "156", "250", "248", "253", "255"]}
{"id": "148", "subject": "[P1-04] Implement language mapping", "description": "Repo: /home/user/working/crush. Spec: Phase 1A languages.go mapping overrides/aliases. Implement extension overrides (.jsx/.tsx/.cs/.ml/.mli/.kt/.tf/.hcl), alias table (tsx->typescript query key), HasTags behavior, and bootstrap languages manifest loading. Files: internal/treesitter/languages.go and embedded assets. Verification: add mapping tests and run `go test ./internal/treesitter/...`. Subagent prompt: 'Implement language/extension mapping and alias behavior exactly as task; include tests for overrides and HasTags.'", "status": "pending", "blockedBy": ["145"], "blocks": ["152", "156"]}
{"id": "149", "subject": "[P1-07] Register full language set", "description": "Repo: /home/user/working/crush. Spec: Phase 1B registration and mapping coverage. Extend language registry and manifest for supported languages and query-key resolution; ensure type aliases/dual-language modules (e.g., ocaml/interface, csharp naming, typescript/tsx behavior) are handled. Files: internal/treesitter/languages.go, languages.json. Verification: mapping tests + `go test ./internal/treesitter/...`. Subagent prompt: 'Register all supported languages and aliases with tests ensuring expected query-key resolution.'", "status": "pending", "blockedBy": ["151", "154"], "blocks": ["155", "150", "156"]}
{"id": "150", "subject": "[P1-09] Add language mapping goldens", "description": "Repo: /home/user/working/crush. Spec: Phase 1A/1B mapping verification. Add golden tests for extension->language and language->query-key mapping, including .tsx parity behavior and alias expectations. Files: internal/treesitter/*_test.go, testdata if needed. Verification: `go test ./internal/treesitter/...`. Subagent prompt: 'Add golden coverage for mapping behavior and ensure stability across supported extensions.'", "status": "pending", "blockedBy": ["149"], "blocks": ["156"]}
{"id": "151", "subject": "[P1-06] Expand language dependencies", "description": "Repo: /home/user/working/crush. Spec: Phase 1B dependency expansion and manual exception (QL). Add remaining grammar deps/pins in go.mod/go.sum according to plan policy, keeping provenance comments where appropriate. Verification: `go test ./internal/treesitter/...` compiles with expanded deps. Subagent prompt: 'Add full Phase 1B language dependency set and ensure module graph compiles.'", "status": "pending", "blockedBy": ["147"], "blocks": ["154", "149", "156"]}
{"id": "152", "subject": "[P1-03] Implement cache/query extraction", "description": "Repo: /home/user/working/crush. Spec: Phase 1A cache.go/query.go contracts. Implement LRU tree cache with byte+entry caps, clone ownership, explicit CGO Close behavior; implement query loading/compilation cache, capture extraction (parity modern captures + enhanced legacy handling), predicate policy, and error handling policy. Files: internal/treesitter/cache.go, internal/treesitter/query.go. Verification: `go test ./internal/treesitter/...` including extraction tests. Subagent prompt: 'Implement cache and query extraction contracts with explicit resource ownership and parity-mode capture behavior.'", "status": "pending", "blockedBy": ["146", "148"], "blocks": ["147", "156"]}
{"id": "153", "subject": "[P1-11] Add CGO diagnostic files", "description": "Repo: /home/user/working/crush. Spec: Phase 1C diagnostic files. Add internal/treesitter/cgo_check.go (build tag cgo) and cgo_check_nocgo.go (build tag !cgo) with required panic message contract for no-CGO path. Verification: compile checks under both tags where feasible. Subagent prompt: 'Add cgo guard files and confirm build-tag behavior.'", "status": "pending", "blockedBy": ["145"], "blocks": ["156"]}
{"id": "154", "subject": "[P1-08] Vendor all tags queries", "description": "Repo: /home/user/working/crush. Spec: Phase 1B query vendoring + primary/fallback precedence. Vendor required *-tags.scm files into internal/treesitter/queries/, preserving naming and source precedence policy; include initial drift checks if lightweight. Verification: query loading tests + `go test ./internal/treesitter/...`. Subagent prompt: 'Vendor and wire full query set for all supported languages while preserving load/precedence behavior.'", "status": "pending", "blockedBy": ["151"], "blocks": ["149", "156"]}
{"id": "155", "subject": "[P1-10] Update Taskfile CGO tasks", "description": "Repo: /home/user/working/crush. Spec: Phase 1C. Update Taskfile.yaml to enforce CGO-enabled default build/test in this fork, add/adjust test:parity and test:exceed placeholders/targets, and tsaudit task placeholders if not yet implemented. Ensure parity/exceed tasks fail fast when CGO not enabled. Verification: run relevant `task` targets in dry/real mode and confirm behavior. Subagent prompt: 'Implement CGO-oriented Taskfile updates with explicit fail-fast checks and minimal disruption to existing targets.'", "status": "pending", "blockedBy": ["147", "149"], "blocks": ["156"]}
{"id": "156", "subject": "[P1-GATE] Verify Phase 1 completion", "description": "Gate task. Repo: /home/user/working/crush. Plan refs: Phase 1 (1A/1B/1C) gate. Files: no planned source edits; if failures occur, only touch /home/user/working/crush/internal/treesitter/* and /home/user/working/crush/Taskfile.yaml. Acceptance: all Phase 1 parser lifecycle, mapping, query extraction, CGO diagnostics, and task wiring criteria pass with evidence. Verification: `go test ./internal/treesitter/...` and `task test:parity`/`task test:exceed` (or current CGO parity targets) as defined in /home/user/working/crush/Taskfile.yaml. Subagent prompt (exact): \"Run the full Phase 1 gate checks, fix only failing Phase 1 items, and report evidence.\"", "status": "pending", "blockedBy": ["145", "146", "148", "152", "147", "151", "154", "149", "150", "155", "153", "144"], "blocks": ["165", "160", "228", "170"]}
{"id": "158", "subject": "[P2-03] Enforce fallback chain ordering", "description": "Repo: /home/user/working/crush. Plan refs: Phase 2A fallback chain ordering. Files: modify /home/user/working/crush/internal/lcm/explorer/explorer.go and add/update tests in /home/user/working/crush/internal/lcm/explorer/explorer_test.go. Acceptance: enforce order Binary -> structured formats -> TreeSitterExplorer -> Shell -> Text -> Fallback, including shebang/content delegation parity in fallback paths. Verification: `go test ./internal/lcm/explorer/... -run Fallback|Dispatch|Order`. Subagent prompt (exact): \"Implement fallback-chain ordering and dispatch tests exactly per Phase 2A.\"", "status": "pending", "blockedBy": ["255"], "blocks": ["163", "170"]}
{"id": "159", "subject": "[P2-06] Add stdlib datasets", "description": "Repo: /home/user/working/crush. Spec: Phase 2B stdlib tables. Add per-language stdlib classifiers under internal/lcm/explorer/stdlib/ (go/python/node/rust/java/csharp/ruby/swift/c/cpp/kotlin/scala/haskell/php) and wire classification helpers used by enrichment. Verification: unit tests for import category mapping. Subagent prompt: 'Add stdlib datasets and classifier helpers with tests for stdlib/third_party/local categorization.'", "status": "pending", "blockedBy": ["164"], "blocks": ["163", "170"]}
{"id": "160", "subject": "[P2-04] Retire validated regex explorers", "description": "Repo: /home/user/working/crush. Plan refs: Phase 2A regex retirement scope. Files: update /home/user/working/crush/internal/lcm/explorer/registry*.go and any regex explorer files under /home/user/working/crush/internal/lcm/explorer/, plus related tests. Acceptance: retire regex explorers only for validated tree-sitter languages (Go, Python, JS, Ruby, Rust, Java, C, C++, TypeScript when validated), keep Shell explorer active, preserve unsupported-language paths. Verification: `go test ./internal/lcm/explorer/...`. Subagent prompt (exact): \"Retire only validated regex explorers, keep shell fallback, and update tests.\"", "status": "pending", "blockedBy": ["156", "253"], "blocks": ["170"]}
{"id": "161", "subject": "[P2-10] Wire decorator persistence", "description": "Repo: /home/user/working/crush. Spec: Phase 2D and 2A integration requirement. Modify internal/lcm/message_decorator.go Create path after InsertLargeTextContent to invoke runtime adapter and persist exploration via UpdateLcmLargeFileExploration; enforce DisableLargeToolOutput and LargeToolOutputTokenThreshold gates; failure must be non-blocking. Verification: `go test ./internal/lcm/...`. Subagent prompt: 'Implement runtime persistence wiring in decorator with strict non-blocking failure semantics and config gates.'", "status": "pending", "blockedBy": ["165", "168"], "blocks": ["167", "169", "170"]}
{"id": "162", "subject": "[P2-08] Add formatting golden tests", "description": "Repo: /home/user/working/crush. Plan refs: Phase 2C testing. Files: update /home/user/working/crush/internal/lcm/explorer/*_test.go and goldens under /home/user/working/crush/internal/lcm/explorer/testdata/. Acceptance: golden coverage for formatting/truncation marker normalization and regression checks showing information quality not worse than prior regex output. Verification: `go test ./internal/lcm/explorer/...`. Subagent prompt (exact): \"Add Phase 2C formatting goldens and regression checks, then run explorer tests.\"", "status": "pending", "blockedBy": ["163"], "blocks": ["170"]}
{"id": "163", "subject": "[P2-07] Implement formatted output", "description": "Repo: /home/user/working/crush. Plan refs: Phase 2C formatted output contract. Files: implement in /home/user/working/crush/internal/lcm/explorer/formatter*.go and /home/user/working/crush/internal/lcm/explorer/explorer*.go; update tests/goldens in /home/user/working/crush/internal/lcm/explorer/testdata/. Acceptance: Volt-comparable sectioned output, progressive disclosure, profile-specific truncation markers (parity accepted variants vs enhancement canonical), deterministic rendering. Verification: `go test ./internal/lcm/explorer/...` and `go test ./internal/lcm/explorer/... -update` when needed. Subagent prompt (exact): \"Implement Phase 2C formatting and marker behavior by profile with deterministic output.\"", "status": "pending", "blockedBy": ["164", "159", "158"], "blocks": ["165", "162", "170"]}
{"id": "164", "subject": "[P2-05] Implement heuristic enrichment", "description": "Repo: /home/user/working/crush. Spec: Phase 2B. Create internal/lcm/explorer/heuristic.go with EnrichAnalysis(...) for import categorization, idiom detection, visibility inference, and module-pattern detection; integrate into tree-sitter explorer flow. Verification: heuristic tests + explorer tests. Subagent prompt: 'Implement heuristic enrichment pipeline and integrate with explorer output generation.'", "status": "pending", "blockedBy": ["253"], "blocks": ["163", "159", "170"]}
{"id": "165", "subject": "[P2-09] Add runtime adapter", "description": "Repo: /home/user/working/crush. Spec: Phase 2D. Create internal/lcm/explorer/runtime.go adapter returning (summary, explorer, err) and building registry with optional tree-sitter parser. Keep interface minimal for decorator usage. Verification: runtime adapter tests and compile. Subagent prompt: 'Implement runtime adapter for decorator persistence path, with clear return contract and tests.'", "status": "pending", "blockedBy": ["163", "156"], "blocks": ["168", "161", "170"]}
{"id": "167", "subject": "[P2-11] Enforce retrieval scope rules", "description": "Repo: /home/user/working/crush. Spec: Phase 2D retrieval rules. Update internal/agent/tools/lcm_describe.go and lcm_expand.go for lineage scope enforcement (self+ancestors allowed, unrelated denied), persisted/non-persisted behavior, and parity-mode authorization constraints for lcm_expand. Verification: tool tests and integration tests. Subagent prompt: 'Implement retrieval scope and authorization semantics exactly as task requires, with tests for allowed/denied cases.'", "status": "pending", "blockedBy": ["161"], "blocks": ["169", "170", "241"]}
{"id": "168", "subject": "[P2-12] Add runtime inventory artifact", "description": "Repo: /home/user/working/crush. Spec: Gate B3 inventory contract. Create internal/lcm/explorer/testdata/parity_volt/runtime_ingestion_paths.v1.json with required schema fields (version, generated_at, discovery_method, profile, paths[] and path entry fields) including mandatory IDs and path_kind values. Add validation helper/tests to fail on drift between discovered paths and artifact. Verification: parity path validation tests. Subagent prompt: 'Create and validate the runtime inventory artifact schema/content and add drift-detection test coverage.'", "status": "pending", "blockedBy": ["165"], "blocks": ["161", "169", "170", "237"]}
{"id": "169", "subject": "[P2-13] Add runtime E2E coverage tests", "description": "Repo: /home/user/working/crush. Plan refs: Phase 2D + B3 runtime-path coverage. Files: add integration tests in /home/user/working/crush/internal/lcm/*_test.go and /home/user/working/crush/internal/agent/tools/*_test.go; use runtime inventory artifact at /home/user/working/crush/internal/lcm/explorer/testdata/parity_volt/runtime_ingestion_paths.v1.json. Acceptance: E2E assertions for persisted/non-persisted ingestion+retrieval, scope checks for `lcm_describe`/`lcm_expand`, and config-gating/failure paths. Verification: `go test ./internal/lcm/... ./internal/agent/tools/... -run Runtime|Inventory|Describe|Expand`. Subagent prompt (exact): \"Add runtime-path E2E tests covering persistence, scope authorization, and gating behavior.\"", "status": "pending", "blockedBy": ["161", "167", "168"], "blocks": ["170", "241"]}
{"id": "170", "subject": "[P2-GATE] Verify Phase 2 completion", "description": "Gate task. Repo: /home/user/working/crush. Plan refs: Phase 2 gate (2A/2B/2C/2D). Files: no planned edits; if failures occur, limit fixes to /home/user/working/crush/internal/lcm/explorer/*, /home/user/working/crush/internal/lcm/message_decorator.go, and /home/user/working/crush/internal/agent/tools/lcm_*.go. Acceptance: fallback ordering, enrichment/formatting, runtime persistence, and inventory-driven retrieval coverage all pass. Verification: `go test ./internal/lcm/explorer/...` and `go test ./internal/lcm/... ./internal/agent/tools/...`. Subagent prompt (exact): \"Run the full Phase 2 gate suite, fix only Phase 2 failures, and report evidence.\"", "status": "pending", "blockedBy": ["158", "160", "164", "159", "163", "162", "165", "168", "161", "167", "169", "156", "248", "253", "255"], "blocks": ["208", "211", "206", "210", "221", "228"]}
{"id": "171", "subject": "[P3-02] Validate 3A.0 determinism", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.0 criterion #3 (determinism). Add determinism assertions for files refresh mode: 10 repeated runs with unchanged inputs; parity mode compares comparator-normalized hashes; enhancement mode compares byte-identical raw output hashes. Files: internal/repomap/vertical_slice_test.go (or dedicated determinism test file). Verification: `go test ./internal/repomap/... -run Determinism`. Delegation prompt (exact): \"Implement deterministic repeated-run assertions for 3A.0 exactly as described, run tests, and report evidence.\"", "status": "pending", "blockedBy": ["250"], "blocks": ["249"]}
{"id": "173", "subject": "[P3-03] Validate 3A.0 stage invariants", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.0 criterion #4 + Stage semantics. Add tests asserting stage assembly invariants: stage0 special prelude (optional), stage1 ranked defs, stage2 graph-node filename entries, stage3 remaining repo filename entries, trim order 3->2->1 while preserving stage0 prepend priority. Files: internal/repomap/vertical_slice_test.go and related helpers. Verification: `go test ./internal/repomap/... -run Stage`. Delegation prompt (exact): \"Implement stage invariant assertions for 3A.0 with fixture-driven checks and run tests.\"", "status": "pending", "blockedBy": ["250"], "blocks": ["249"]}
{"id": "174", "subject": "[P3-01] Validate 3A.0 budget semantics", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.0 criterion #2 + Gate A token semantics. Add budget assertions: in parity mode validate comparator acceptance path (`parityTokenCount` semantics); in enhancement mode enforce `safetyTokenCount <= TokenBudget`. Ensure tests record both counters. Files: internal/repomap/vertical_slice_test.go, internal/repomap/tokens_test.go as needed. Verification: `go test ./internal/repomap/... -run Budget`. Delegation prompt (exact): \"Implement profile-scoped budget assertions for 3A.0 and provide test evidence.\"", "status": "pending", "blockedBy": ["250"], "blocks": ["249"]}
{"id": "177", "subject": "[P3-13] Implement incremental mtime caching", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.1 incremental refresh + Phase 3D tag cache. Implement mtime-based incremental update behavior using repo_map_file_cache and repo_map_tags, including changed-file re-extract and stale-path prune integration. Files: internal/repomap/tags.go/internal/repomap/cache paths and tests. Verification: `go test ./internal/repomap/... -run Mtime|Prune`. Delegation prompt (exact): \"Implement incremental mtime refresh logic and pruning semantics, then provide test output.\"", "status": "pending", "blockedBy": ["178"], "blocks": ["189", "192"]}
{"id": "178", "subject": "[P3-12] Implement tag extraction pipeline", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.1 tag extraction pipeline + dependency on filetracker normalization (#244). Files: implement in /home/user/working/crush/internal/repomap/tags.go, /home/user/working/crush/internal/repomap/extract*.go, and related tests in /home/user/working/crush/internal/repomap/*_test.go. Acceptance: extract defs/refs from file universe using normalized paths, persist/update tag records consistently, and preserve deterministic ordering for downstream graph build. Verification: `go test ./internal/repomap/... -run Tag|Extract`. Subagent prompt (exact): \"Implement Phase 3A.1 tag extraction pipeline on normalized paths and run repomap extraction tests.\"", "status": "pending", "blockedBy": ["244", "254"], "blocks": ["177", "179", "187", "191", "192", "197"]}
{"id": "179", "subject": "[P3-14] Implement graph construction", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.1 graph.go. Implement weighted graph construction from def/ref tags with identifier multipliers (mentioned idents, long names, private names, high-frequency names), referencer chat-file multiplier, edge weight formula `use_mul * sqrt(num_refs)`, and required fallback ordering (lexical backfill -> global no-ref fallback -> orphan self-edges -> cross-file edges). Verification: `go test ./internal/repomap/... -run Graph`. Delegation prompt (exact): \"Implement graph construction semantics per task and validate with graph tests.\"", "status": "pending", "blockedBy": ["178"], "blocks": ["181", "180", "183", "192"]}
{"id": "180", "subject": "[P3-15] Add graph behavior tests", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 3A.1 graph semantics + Phase 3 gate test coverage. Files: modify /home/user/working/crush/internal/repomap/graph_test.go and only add helper fixtures under /home/user/working/crush/internal/repomap/testdata/graph/ if required. Acceptance: deterministic tests cover fallback ordering (lexical backfill -> global no-ref fallback -> orphan self-edges -> cross-file edges), edge-weight behavior, and orphan/self-edge handling, with stable assertions across repeated runs. Verification: `go test ./internal/repomap/... -run Graph`. Subagent prompt (exact): \"Create deterministic graph behavior tests for fallback ordering and weighting semantics, run graph-focused tests, and report changed files plus test output.\"", "status": "pending", "blockedBy": ["179"], "blocks": ["192"]}
{"id": "181", "subject": "[P3-21] Implement personalized PageRank", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3B pagerank.go. Implement personalized PageRank: damping 0.85, convergence delta threshold, conditional dangling override only with non-empty personalization, degenerate fallbacks, and rank distribution to definitions/files. Implement personalization vector rules (chat files additive, mentioned fnames max, path-component idents once-per-file). Verification: `go test ./internal/repomap/... -run PageRank`. Delegation prompt (exact): \"Implement personalized PageRank and distribution logic with tests passing.\"", "status": "pending", "blockedBy": ["179"], "blocks": ["182", "183", "184", "192"]}
{"id": "182", "subject": "[P3-22] Add PageRank tests", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 3B personalized PageRank validation. Files: modify /home/user/working/crush/internal/repomap/pagerank_test.go and add fixture helpers under /home/user/working/crush/internal/repomap/testdata/pagerank/ only if needed. Acceptance: tests validate star/chain/disconnected graphs, convergence behavior, personalization effects, dangling-node handling, and deterministic rank ordering/tie-breaking where defined. Verification: `go test ./internal/repomap/... -run PageRank`. Subagent prompt (exact): \"Add PageRank validation tests for required graph patterns and personalization semantics, run PageRank tests, and report diffs and output.\"", "status": "pending", "blockedBy": ["181"], "blocks": ["192"]}
{"id": "183", "subject": "[P3-31] Implement stage assembly", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3C stage assembly. Implement stage-0+1/2/3 assembly before fitting: stage0 special prelude, stage1 ranked definitions, stage2 remaining graph nodes filename entries, stage3 remaining repo files filename entries; preserve profile ordering semantics. Files: internal/repomap/budget.go/render pipeline helpers. Verification: `go test ./internal/repomap/... -run Stage|Assemble`. Delegation prompt (exact): \"Implement stage assembly pipeline exactly and verify with tests.\"", "status": "pending", "blockedBy": ["181", "179"], "blocks": ["184", "188", "187", "191", "192"]}
{"id": "184", "subject": "[P3-32] Implement token accounting core", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3C tokens.go. Implement TokenCounter abstraction, tokenizer provider contract hooks, parity/safety counter split (`parity_tokens`, `safety_tokens`), heuristic fallback ratio table, and metadata wiring for comparator tuple capture. Verification: `go test ./internal/repomap/... -run Token`. Delegation prompt (exact): \"Implement token accounting core with parity/safety split and tests.\"", "status": "pending", "blockedBy": ["183", "181"], "blocks": ["188", "192"]}
{"id": "185", "subject": "[P3-42] Implement last-good caches", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 3D last-good/session cache behavior. Files: modify /home/user/working/crush/internal/repomap/repomap.go, /home/user/working/crush/internal/repomap/cache.go (or existing cache file), and /home/user/working/crush/internal/repomap/*_test.go for cache accessors/concurrency tests. Acceptance: thread-safe per-session last-good map/token caches are implemented; LastGoodMap and LastTokenCount accessors return consistent values under concurrent reads/writes; lifecycle/reset paths preserve required invariants. Verification: `go test ./internal/repomap/... -run LastGood|Cache`. Subagent prompt (exact): \"Implement thread-safe last-good/session cache behavior with accessor and concurrency tests, then run targeted repomap cache tests and report results.\"", "status": "pending", "blockedBy": ["254"], "blocks": ["189", "192"]}
{"id": "186", "subject": "[P3-36] Add render/budget goldens", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 3C render/budget output validation. Files: modify /home/user/working/crush/internal/repomap/render_test.go and add/update goldens under /home/user/working/crush/internal/repomap/testdata/render_budget/. Acceptance: golden tests validate rendered output/stage-membership traces, budget-fit behavior, and reported token counters; output is deterministic and golden updates are intentional. Verification: `go test ./internal/repomap/... -run Render|Budget|Golden`. Subagent prompt (exact): \"Add/refresh render and budget goldens with deterministic assertions, run the render/budget test suite, and report changed files and test output.\"", "status": "pending", "blockedBy": ["188", "191", "187"], "blocks": ["190", "192"]}
{"id": "187", "subject": "[P3-35] Implement special-file prelude", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3C special.go. Implement special-file prelude set/logic (root scoping + .github/workflows exception), stage-0 insertion constraints, and parity-mode source rule from other_fnames only. Verification: `go test ./internal/repomap/... -run Special`. Delegation prompt (exact): \"Implement special-file prelude behavior and tests per task constraints.\"", "status": "pending", "blockedBy": ["183", "178"], "blocks": ["186", "192"]}
{"id": "188", "subject": "[P3-33] Implement budget-fit search", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3C budget fit. Implement binary search fitting over assembled tag list with initial guess policy, profile-scoped acceptance behavior, and best-candidate tracking. Ensure parity mode comparator acceptance semantics and enhancement strict-safety semantics. Verification: `go test ./internal/repomap/... -run Budget|Fit`. Delegation prompt (exact): \"Implement budget-fit search logic and validate profile-specific behavior with tests.\"", "status": "pending", "blockedBy": ["183", "184"], "blocks": ["186", "192"]}
{"id": "189", "subject": "[P3-43] Implement reset/refresh invalidation", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3D + Phase 0A lifecycle. Implement Refresh and Reset invalidation semantics, including clearing rankings and session read-only paths. Ensure behavior aligns with sqlc query surfaces. Verification: `go test ./internal/repomap/... -run Refresh|Reset`. Delegation prompt (exact): \"Implement reset/refresh invalidation lifecycle and validate with targeted tests.\"", "status": "pending", "blockedBy": ["190", "185", "177"], "blocks": ["192"]}
{"id": "190", "subject": "[P3-41] Implement render cache modes", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3D render cache modes. Files: modify /home/user/working/crush/internal/repomap/cache*.go and /home/user/working/crush/internal/repomap/repomap.go; add/update /home/user/working/crush/internal/repomap/*_test.go. Acceptance: refresh-mode-specific cache keys and semantics for auto/files/manual/always are enforced and tested. Verification: `go test ./internal/repomap/... -run Cache|RefreshMode`. Subagent prompt (exact): \"Implement render-cache mode semantics for auto/files/manual/always with tests.\"", "status": "pending", "blockedBy": ["186"], "blocks": ["189", "192", "200"]}
{"id": "191", "subject": "[P3-34] Implement TreeContext renderer", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3C TreeContext. Implement scope-aware renderer behavior (header/scopes/gap handling/format) for repo-map output. Files: internal/repomap/treecontext.go + renderer integration. Verification: `go test ./internal/repomap/... -run TreeContext|Render`. Delegation prompt (exact): \"Implement TreeContext-based rendering and run render-focused tests.\"", "status": "pending", "blockedBy": ["183", "178"], "blocks": ["186", "192"]}
{"id": "192", "subject": "[P3-GATE] Verify Phase 3 completion", "description": "Gate task. Repo: /home/user/working/crush. Plan refs: Phase 3 full gate (3A.0, 3A.1, 3B, 3C, 3D). Files: no planned edits; if failures occur, limit to /home/user/working/crush/internal/repomap/*.go and /home/user/working/crush/internal/repomap/*_test.go. Acceptance: all Phase 3 criteria pass with command evidence and artifact references. Verification: `go test ./internal/repomap/...`. Subagent prompt (exact): \"Run Phase 3 gate verification and fix only Phase 3 failures.\"", "status": "pending", "blockedBy": ["178", "177", "179", "180", "181", "182", "183", "184", "188", "191", "187", "186", "190", "185", "189", "249", "254"], "blocks": ["193", "217", "228", "202", "241"]}
{"id": "193", "subject": "[P4-01] Add prepare hook extension", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4A. Implement PrepareStepHook extension points: add PrepareStepHook type in internal/agent/hooks.go, add prepareStepHooks field/setter in internal/agent/agent.go, and invoke hooks in Run PrepareStep path only (not summarize/title paths). Keep diff minimal and preserve existing behavior. Verification: `go test ./internal/agent/...`. Delegation prompt (exact): \"Implement prepare hook extension points with minimal upstream-file edits and run agent tests.\"", "status": "pending", "blockedBy": ["192"], "blocks": ["194", "199", "202"]}
{"id": "194", "subject": "[P4-02] Wire coordinator repo-map option", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4A coordinator wiring. Implement internal/agent/coordinator_opts.go with CoordinatorOption, WithRepoMap, RepoMapService interface, and buildRepoMapHook skeleton integration; modify internal/agent/coordinator.go for opts apply loop and hook attachment. Preserve extraTools gating behavior. Verification: `go test ./internal/agent/...`. Delegation prompt (exact): \"Implement coordinator repo-map option plumbing and compile-safe hook wiring.\"", "status": "pending", "blockedBy": ["193"], "blocks": ["196", "195", "202"]}
{"id": "195", "subject": "[P4-03] Wire app repo-map lifecycle", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4A app wiring. Add internal/app/repomap.go init path and minimal internal/app/app.go wiring: store option/service, call initRepoMap in New(), pass option into NewCoordinator, and close repoMapSvc before cleanup fan-out in Shutdown. Verification: `go test ./internal/app/... ./internal/agent/...`. Delegation prompt (exact): \"Implement app-level repo-map lifecycle wiring with shutdown ordering guarantees.\"", "status": "pending", "blockedBy": ["194"], "blocks": ["196", "201", "202"]}
{"id": "196", "subject": "[P4-04] Implement map message injection", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4A map message injection format. Files: update /home/user/working/crush/internal/agent/coordinator*.go and /home/user/working/crush/internal/agent/hooks*.go; add tests in /home/user/working/crush/internal/agent/*_test.go. Acceptance: inject repo-map user+assistant pair (assistant cache-control set) after system prompt and before history using plan template and cacheControlOptions helper. Verification: `go test ./internal/agent/... -run RepoMap|Hook|Inject`. Subagent prompt (exact): \"Implement Phase 4A repo-map message pair injection with required ordering and cache-control behavior.\"", "status": "pending", "blockedBy": ["195", "194"], "blocks": ["200", "197", "198", "202"]}
{"id": "197", "subject": "[P4-06] Implement mention extraction", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4B mentions extraction. Files: add /home/user/working/crush/internal/repomap/mentions.go (or update existing helper files), integrate in /home/user/working/crush/internal/agent/*.go, and add tests in /home/user/working/crush/internal/repomap/*_test.go plus /home/user/working/crush/internal/agent/*_test.go. Acceptance: implement current-run message extraction, mentioned file/ident extraction, filename-ident matching, path normalization, and dedup semantics. Verification: `go test ./internal/repomap/... ./internal/agent/... -run Mention|Extract`. Subagent prompt (exact): \"Implement mention-extraction helpers and integration semantics with tests.\"", "status": "pending", "blockedBy": ["196", "178", "244"], "blocks": ["202", "207"]}
{"id": "198", "subject": "[P4-05] Integrate LCM overhead tokens", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4B + Phase 3-LCM integration for RepoMapTokens overhead. Files: integrate in /home/user/working/crush/internal/agent/coordinator*.go and /home/user/working/crush/internal/agent/hooks*.go; consume API from /home/user/working/crush/internal/lcm/manager.go. Acceptance: after map generation/fallback, hook path sets RepoMapTokens overhead via LCM API and uses consistent source-of-truth token count. Verification: `go test ./internal/agent/... ./internal/lcm/... -run RepoMapTokens|Hook`. Subagent prompt (exact): \"Wire hook-side RepoMapTokens updates after repo-map generation/fallback and verify with tests.\"", "status": "pending", "blockedBy": ["196", "245"], "blocks": ["202", "207"]}
{"id": "199", "subject": "[P4-07] Implement per-Run guard", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4B per-Run injection guard + dependency on RunInjectionKey propagation (#243). Files: implement in /home/user/working/crush/internal/repomap/repomap.go and /home/user/working/crush/internal/agent/*.go tests. Acceptance: ShouldInject is atomic per RunInjectionKey, enforces one injection per run, and behaves correctly under concurrent/recursive run paths. Verification: `go test ./internal/repomap/... ./internal/agent/... -run ShouldInject|RunKey|Guard`. Subagent prompt (exact): \"Implement atomic per-run ShouldInject semantics keyed by RunInjectionKey and validate concurrency behavior.\"", "status": "pending", "blockedBy": ["193", "243", "254"], "blocks": ["200", "202"]}
{"id": "200", "subject": "[P4-08] Implement refresh mode logic", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4B refresh modes. Files: update /home/user/working/crush/internal/repomap/repomap.go, /home/user/working/crush/internal/agent/coordinator*.go, and refresh-mode tests under /home/user/working/crush/internal/repomap/*_test.go and /home/user/working/crush/internal/agent/*_test.go. Acceptance: implement auto/files/manual/always semantics, parity force-refresh attempt #1, fallback attempts, and prompt-cache auto->files coercion with one source-of-truth. Verification: `go test ./internal/repomap/... ./internal/agent/... -run Refresh|Mode|Fallback`. Subagent prompt (exact): \"Implement full refresh-mode semantics and parity/enhancement behavior with tests.\"", "status": "pending", "blockedBy": ["196", "199", "190"], "blocks": ["204", "202", "207"]}
{"id": "201", "subject": "[P4-10] Add refresh/reset controls", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4 controls (map refresh/reset command paths) + dependency on tool exposure task #242. Files: update command/control wiring in /home/user/working/crush/internal/app/*.go and /home/user/working/crush/internal/agent/*.go; tests in /home/user/working/crush/internal/app/*_test.go and /home/user/working/crush/internal/agent/*_test.go. Acceptance: project:map-refresh and project:map-reset control paths are wired, policy-enforced, and consistent with refresh-mode constraints; map_reset is not exposed as unrestricted external tool. Verification: `go test ./internal/app/... ./internal/agent/... -run MapRefresh|MapReset|Control`. Subagent prompt (exact): \"Wire refresh/reset controls with policy enforcement and verify behavior in app/agent tests.\"", "status": "pending", "blockedBy": ["195", "204", "242"], "blocks": ["202", "207"]}
{"id": "202", "subject": "[P4-GATE] Verify Phase 4 completion", "description": "Gate task. Repo: /home/user/working/crush. Plan refs: Phase 4 gate (4A/4B + auth matrix + controls). Files: no planned edits; if needed, limit to /home/user/working/crush/internal/agent/*, /home/user/working/crush/internal/app/*, /home/user/working/crush/internal/repomap/*, and /home/user/working/crush/internal/lcm/*. Acceptance: prompt injection, refresh logic, controls, auth matrix, and integration E2E checks all pass. Verification: `go test ./internal/agent/... ./internal/app/... ./internal/repomap/... ./internal/lcm/... ./internal/agent/tools/...`. Subagent prompt (exact): \"Run Phase 4 gate verification and fix only Phase 4 failures.\"", "status": "pending", "blockedBy": ["193", "194", "195", "196", "198", "197", "199", "200", "204", "201", "207", "241", "242", "243", "244", "245", "192"], "blocks": ["203", "213", "217", "221", "220", "228", "225", "206", "210", "211", "209", "208"]}
{"id": "203", "subject": "[P5-01] Apply performance polish", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5A performance polish. Files: limit edits to /home/user/working/crush/internal/treesitter/*.go, /home/user/working/crush/internal/repomap/*.go, and corresponding benchmark/test files only. Acceptance: targeted optimizations improve or preserve benchmark performance in touched hot paths, introduce no semantic behavior change, and keep tests passing. Verification: `go test ./internal/treesitter/... ./internal/repomap/...` and at least one benchmark command for each touched subsystem (for example `go test ./internal/treesitter/... -bench=.` and/or `go test ./internal/repomap/... -bench=.`). Subagent prompt (exact): \"Implement Phase 5A performance optimizations only in treesitter/repomap hot-path files, preserve behavior, run required tests/benchmarks, and report evidence.\"", "status": "pending", "blockedBy": ["202"], "blocks": ["205", "225"]}
{"id": "204", "subject": "[P4-09] Implement async dedup flow", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4B async dedup/scheduling. Files: modify /home/user/working/crush/internal/repomap/repomap.go and /home/user/working/crush/internal/repomap/singleflight*.go; tests in /home/user/working/crush/internal/repomap/*_test.go. Acceptance: dual singleflight scopes for indexing and map generation, async refresh scheduling tied to lifecycle context with cancellation-safe behavior. Verification: `go test ./internal/repomap/... -run Singleflight|RefreshAsync`. Subagent prompt (exact): \"Implement async dedup and lifecycle-safe refresh scheduling with concurrent tests.\"", "status": "pending", "blockedBy": ["200"], "blocks": ["201", "202", "207"]}
{"id": "205", "subject": "[P5-02] Capture benchmark evidence", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5A benchmark evidence. Files: no code edits expected; produce evidence from /home/user/working/crush/internal/treesitter/... and /home/user/working/crush/internal/repomap/... benchmark/test packages. Acceptance: collect benchmark outputs plus correctness confirmation and summarize before/after impact against task #203 changes. Verification: `go test ./internal/treesitter/... -bench=.` and `go test ./internal/repomap/... -bench=.` and correctness rerun `go test ./internal/treesitter/... ./internal/repomap/...`. Subagent prompt (exact): \"Run Phase 5A benchmark and correctness evidence capture and provide a concise results report.\"", "status": "pending", "blockedBy": ["203"], "blocks": ["225"]}
{"id": "206", "subject": "[P5-04] Add LaTeX explorer", "description": "Repo: /home/user/working/crush. Phase 5B LaTeX explorer. Add LaTeX explorer implementation under internal/lcm/explorer (latex*.go) with section/subsection counts, environment inventory, and bibliography metadata extraction. Add tests/fixtures. Required verification: `go test ./internal/lcm/explorer/... -run LaTeX|Latex`. Subagent execution prompt (exact): \"Implement LaTeX explorer and tests per TODO, run verification, and return evidence.\"", "status": "pending", "blockedBy": ["170", "202"], "blocks": ["209", "225"]}
{"id": "207", "subject": "[P4-11] Add integration E2E tests", "description": "Repo: /home/user/working/crush. Plan refs: Phase 4 integration E2E + retrieval auth matrix (#241). Files: add/update tests in /home/user/working/crush/internal/agent/*_test.go, /home/user/working/crush/internal/agent/tools/*_test.go, and /home/user/working/crush/internal/lcm/*_test.go. Acceptance: end-to-end validation of prompt injection, refresh behavior, persisted/non-persisted retrieval paths, and authorization matrix (self/ancestor allowed, unrelated denied) across parity/enhancement modes. Verification: `go test ./internal/agent/... ./internal/agent/tools/... ./internal/lcm/... -run E2E|RepoMap|Auth|Describe|Expand`. Subagent prompt (exact): \"Add Phase 4 E2E tests covering injection, refresh, persistence, and retrieval authorization matrix.\"", "status": "pending", "blockedBy": ["201", "198", "197", "204", "200", "241"], "blocks": ["202"]}
{"id": "208", "subject": "[P5-03] Add Markdown explorer", "description": "Repo: /home/user/working/crush. Phase 5B Markdown explorer. Add Markdown explorer implementation under internal/lcm/explorer (new markdown*.go files) with extraction of frontmatter, heading hierarchy, code-block language histogram, and link/reference counts. Add tests and fixtures under internal/lcm/explorer/testdata as needed. Required verification: `go test ./internal/lcm/explorer/... -run Markdown`. Subagent execution prompt (exact): \"Implement Markdown explorer + tests/fixtures exactly per TODO, run verification command, and report changed files + outputs.\"", "status": "pending", "blockedBy": ["170", "202"], "blocks": ["209", "225"]}
{"id": "209", "subject": "[P5-07] Add format golden suites", "description": "Repo: /home/user/working/crush. Phase 5B combined validation for Markdown/LaTeX/SQLite/Logs explorers. Add or refresh golden fixtures and quality checks under internal/lcm/explorer/testdata; ensure required-field extraction assertions and numeric/count validations are present for new formats. Required verification: `go test ./internal/lcm/explorer/...`. Subagent execution prompt (exact): \"Finalize format golden suites/quality checks for all four new explorers and run full explorer test suite with evidence.\"", "status": "pending", "blockedBy": ["208", "206", "210", "211", "202"], "blocks": ["225"]}
{"id": "210", "subject": "[P5-05] Add SQLite explorer", "description": "Repo: /home/user/working/crush. Phase 5B SQLite explorer. Add SQLite explorer implementation under internal/lcm/explorer (sqlite*.go) with table/index inventory and per-table column summaries (plus optional enhancement extras). Add tests/fixtures. Required verification: `go test ./internal/lcm/explorer/... -run SQLite`. Subagent execution prompt (exact): \"Implement SQLite explorer + tests according to this TODO and provide verification output.\"", "status": "pending", "blockedBy": ["170", "202"], "blocks": ["209", "225"]}
{"id": "211", "subject": "[P5-06] Add Logs explorer", "description": "Repo: /home/user/working/crush. Phase 5B Logs explorer. Add logs explorer under internal/lcm/explorer (logs*.go) with level distribution, timestamp-pattern detection, and representative error/warning sampling (plus enhancement aggregation where feasible). Add tests/fixtures. Required verification: `go test ./internal/lcm/explorer/... -run Logs|Log`. Subagent execution prompt (exact): \"Implement Logs explorer and tests exactly per TODO, run verification, and report results.\"", "status": "pending", "blockedBy": ["170", "202"], "blocks": ["209", "225"]}
{"id": "213", "subject": "[P5-12] Regenerate schema", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5D schema regeneration. Files: regenerate schema outputs touched by config schema pipeline (for example under /home/user/working/crush/internal/config/ and generated schema artifact paths used by the project). Acceptance: RepoMap options are present in generated schema with correct field names/defaults/types. Verification: run the project schema generation task (for example `task schema` or the repository's documented schema command) and then `go test ./internal/config/...`; include command output and changed generated files. Subagent prompt (exact): \"Regenerate schema artifacts for RepoMap options and verify generated schema contains the new fields.\"", "status": "pending", "blockedBy": ["202"], "blocks": ["219", "225"]}
{"id": "214", "subject": "[P5-09] Implement tsaudit update", "description": "Repo: /home/user/working/crush. Phase 5C tsaudit update command. Implement `update` in internal/cmd/tsaudit to refresh manifest/query state deterministically according to policy. Add tests around dry-run/apply behavior where possible. Required verification: `go run ./internal/cmd/tsaudit update --dry-run` (and non-dry-run if safe), plus command tests. Subagent execution prompt (exact): \"Implement tsaudit update command exactly as TODO describes, run verification, and report generated changes.\"", "status": "pending", "blockedBy": ["251"], "blocks": ["216", "215", "225"]}
{"id": "215", "subject": "[P5-11] Wire tsaudit tasks", "description": "Repo: /home/user/working/crush. Phase 5C Taskfile wiring. Modify Taskfile.yaml to add/verify tsaudit targets (`tsaudit`, `tsaudit:update`, `tsaudit:verify`) invoking internal/cmd/tsaudit commands. Ensure commands run from repo root and fail properly on errors. Required verification: run each new task target and capture outputs. Subagent execution prompt (exact): \"Wire tsaudit Taskfile targets and validate each target executes correctly; report exact outputs.\"", "status": "pending", "blockedBy": ["214", "216", "251"], "blocks": ["225"]}
{"id": "216", "subject": "[P5-10] Implement tsaudit verify", "description": "Repo: /home/user/working/crush. Phase 5C tsaudit verify command. Implement strict `verify` in internal/cmd/tsaudit enforcing manifest/query consistency, dual capture-style contract checks, and explicit fail on `; inherits:` drift in vendored queries. Add tests for failure/pass cases. Required verification: `go run ./internal/cmd/tsaudit verify` and command tests. Subagent execution prompt (exact): \"Implement strict tsaudit verify command and tests per TODO, run verification commands, and return evidence.\"", "status": "pending", "blockedBy": ["214"], "blocks": ["215", "225"]}
{"id": "217", "subject": "[P5-14] Build Aider parity fixtures", "description": "Repo: /home/user/working/crush. Phase 5E Aider fixture corpus. Create internal/repomap/testdata/parity_aider fixtures and harness inputs for Gate A checks, including provenance metadata fields: aider_commit_sha, fixtures_sha256, comparator path, grep_ast_provenance, tokenizer_id, tokenizer_version. Add fixture loader utilities/tests. Required verification: fixture loader tests pass in internal/repomap parity tests. Subagent execution prompt (exact): \"Create Aider parity fixtures + provenance metadata wiring and verify fixture loading/tests pass.\"", "status": "pending", "blockedBy": ["202", "192"], "blocks": ["226", "218", "225"]}
{"id": "218", "subject": "[P5-15] Implement A1-A6 checks", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E Gate A aggregate (A1-A6). Files: aggregate in /home/user/working/crush/internal/repomap/parity_test.go plus helper/artifact files under /home/user/working/crush/internal/repomap/testdata/parity_aider/. Acceptance: execute and enforce final Gate A outcome using outputs from A1-A6, and package required per-metric artifacts. Verification: `go test ./internal/repomap/... -run Parity|GateA|A1|A2|A3|A4|A5|A6`. Subagent prompt (exact): \"Implement Gate A aggregation and enforce final A1-A6 outcome with artifact checks.\"", "status": "pending", "blockedBy": ["217", "226", "227", "229", "231", "232", "233", "230", "235"], "blocks": ["224", "223", "225"]}
{"id": "219", "subject": "[P5-13] Update RepoMap docs", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5D docs sync for RepoMap config. Files: update /home/user/working/crush/internal/config/AGENTS.md and any directly related config docs in /home/user/working/crush/docs/. Acceptance: docs match implemented RepoMap fields/defaults/merge/refresh semantics exactly. Verification: `go test ./internal/config/... -run TestConfigMerging` and manual cross-check against /home/user/working/crush/internal/config/config.go, /home/user/working/crush/internal/config/load.go, and /home/user/working/crush/internal/config/repomap.go. Subagent prompt (exact): \"Update RepoMap config docs to match current code and report exact sections changed.\"", "status": "pending", "blockedBy": ["213"], "blocks": ["225"]}
{"id": "220", "subject": "[P5-18] Add parity protocol artifacts", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E parity protocol artifacts. Files: add versioned artifacts under /home/user/working/crush/internal/repomap/testdata/ and /home/user/working/crush/internal/lcm/explorer/testdata/ (including tokenizer_support.v1.json and explorer_family_matrix.v1.json), plus validators in corresponding *_test.go/helper files. Acceptance: required fields/version linkages enforced; tests fail on missing/invalid fields. Verification: `go test ./internal/repomap/... ./internal/lcm/explorer/... -run Protocol|Artifact|Version`. Subagent prompt (exact): \"Add required protocol artifacts and validators, then run protocol validation tests.\"", "status": "pending", "blockedBy": ["202"], "blocks": ["226", "225"]}
{"id": "221", "subject": "[P5-16] Build Volt parity fixtures", "description": "Repo: /home/user/working/crush. Phase 5E Volt fixture corpus. Create internal/lcm/explorer/testdata/parity_volt fixtures for language/format/retrieval/runtime-path scenarios with provenance metadata (volt_commit_sha, fixtures_sha256, comparator path). Include fixtures needed by B1-B5 scoring. Required verification: fixture loaders/tests in explorer parity harness pass. Subagent execution prompt (exact): \"Create Volt parity fixtures and metadata per TODO and verify fixture test loading.\"", "status": "pending", "blockedBy": ["202", "170"], "blocks": ["226", "222", "225"]}
{"id": "222", "subject": "[P5-17] Implement B1-B5 checks", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E Gate B aggregate (B1-B5). Files: aggregate checks in /home/user/working/crush/internal/lcm/explorer/parity_test.go and related helpers/artifacts under /home/user/working/crush/internal/lcm/explorer/testdata/parity_volt/. Acceptance: enforce final Gate B outcome using B1-B5 outputs and package required artifacts. Verification: `go test ./internal/lcm/explorer/... -run Parity|GateB|B1|B2|B3|B4|B5`. Subagent prompt (exact): \"Implement Gate B aggregation and enforce final B1-B5 outcome with artifact checks.\"", "status": "pending", "blockedBy": ["221", "226", "227", "236", "234", "237", "238", "239"], "blocks": ["224", "223", "225"]}
{"id": "223", "subject": "[P5-19] Wire parity/exceed tasks", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E task wiring after Gate A/B + preflight. Files: update /home/user/working/crush/Taskfile.yaml and any parity runner entrypoints under /home/user/working/crush/internal/repomap/ or /home/user/working/crush/internal/lcm/explorer/ as needed. Acceptance: parity/exceed tasks invoke full checks, validate prerequisites, and fail fast on missing fixtures/provenance/preflight conditions. Verification: run the new/updated task targets (e.g., `task test:parity` and `task test:exceed`) and capture outputs. Subagent prompt (exact): \"Wire parity/exceed task targets with prerequisite checks and verify fail-fast behavior.\"", "status": "pending", "blockedBy": ["218", "222", "226"], "blocks": ["224", "225"]}
{"id": "224", "subject": "[P5-20] Add conformance reporting", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E conformance reporting/sign-off bundle. Files: implement in /home/user/working/crush/internal/repomap/* (and /home/user/working/crush/internal/lcm/explorer/* if needed), with artifacts under /home/user/working/crush/internal/repomap/testdata/ or designated output testdata paths. Acceptance: generate atomic sign-off bundle containing comparator SHAs, fixture hashes, protocol/inventory versions, toggles, and A/B outcomes from one run. Verification: `go test ./internal/repomap/... ./internal/lcm/explorer/... -run Conformance|Bundle|Manifest`. Subagent prompt (exact): \"Implement conformance reporting and atomic sign-off bundle generation with validation tests.\"", "status": "pending", "blockedBy": ["218", "222", "223"], "blocks": ["225"]}
{"id": "225", "subject": "[P5-GATE] Verify Phase 5 completion", "description": "Gate task. Repo: /home/user/working/crush. Plan refs: Phase 5 gate (5A/5B/5C/5D/5E plus A1-A6 and B1-B5). Files: no planned edits; if failures occur, limit fixes to /home/user/working/crush/internal/repomap/*, /home/user/working/crush/internal/lcm/explorer/*, /home/user/working/crush/internal/cmd/tsaudit/*, /home/user/working/crush/Taskfile.yaml, and related testdata. Acceptance: all Phase 5 sub-gates pass with required artifacts/provenance. Verification: `go test ./internal/repomap/... ./internal/lcm/explorer/... ./internal/cmd/tsaudit/...` plus Phase 5 parity/exceed task targets from /home/user/working/crush/Taskfile.yaml. Subagent prompt (exact): \"Run full Phase 5 gate verification, fix only Phase 5 failures, and report artifact-backed evidence.\"", "status": "pending", "blockedBy": ["203", "205", "208", "206", "210", "211", "209", "214", "216", "215", "213", "219", "217", "221", "220", "226", "227", "218", "222", "223", "224", "229", "231", "232", "233", "230", "235", "236", "234", "237", "238", "239", "240", "202", "251"], "blocks": ["228"]}
{"id": "226", "subject": "[P5-22] Implement parity preflight", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E parity preflight + provenance integration. Files: implement preflight in /home/user/working/crush/internal/repomap/parity* and /home/user/working/crush/internal/lcm/explorer/parity* helpers; integrate provenance validator from task #240. Acceptance: preflight verifies comparator tuple, tokenizer support, profile object, corpus readiness, and provenance bundle before execution; fails closed on missing prerequisites. Verification: `go test ./internal/repomap/... ./internal/lcm/explorer/... -run Preflight|Provenance`. Subagent prompt (exact): \"Implement fail-closed parity preflight with provenance validation and run targeted tests.\"", "status": "pending", "blockedBy": ["217", "221", "220", "240"], "blocks": ["227", "218", "222", "223", "225"]}
{"id": "227", "subject": "[P5-21] Enforce deterministic scoring", "description": "Repo: /home/user/working/crush. Plan refs: Phase 5E deterministic scoring enforcement. Files: modify deterministic checks in /home/user/working/crush/internal/repomap/parity_test.go and /home/user/working/crush/internal/lcm/explorer/parity_test.go plus helpers. Acceptance: parity runs fail when non-deterministic tiers/flags are enabled and include intentional-failure tests. Verification: `go test ./internal/repomap/... ./internal/lcm/explorer/... -run Deterministic|Scoring|Parity`. Subagent prompt (exact): \"Enforce deterministic scoring mode and prove fail behavior with intentional negative tests.\"", "status": "pending", "blockedBy": ["226"], "blocks": ["218", "222", "225", "229", "231", "230", "232", "233", "236", "235", "234", "238", "237", "239"]}
{"id": "228", "subject": "[ALL-GATE] Final full-plan verification", "description": "Global final gate. Repo: /home/user/working/crush. Plan refs: full-plan sign-off across Phase 0, Phase 1, Phase 2, Phase 3A.0, Phase 3, Phase 4, and Phase 5 gates in docs/PLAN-treesitter-repomap.md. Files: no planned source edits; if failures require fixes, limit scope to files explicitly allowed by the failing phase gate task(s) and do not broaden beyond those gate scopes. Acceptance: all phase gates are complete, lint/test/parity/exceed/sign-off checks pass, no open blocking tasks remain, and final readiness summary includes command evidence and artifact references. Verification: `task lint`, `task test`, and required parity/exceed/sign-off commands as defined in /home/user/working/crush/Taskfile.yaml. Subagent prompt (exact): \"Run final all-phase verification, fix only failures within each phase's allowed gate scope, and produce final sign-off evidence with command outputs and artifact references.\"", "status": "pending", "blockedBy": ["144", "156", "170", "192", "202", "225", "249"], "blocks": []}
{"id": "229", "subject": "[P5-A1] Implement ranking concordance check", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate A1 (ranking concordance). Files: modify /home/user/working/crush/internal/repomap/parity_test.go and add/update helpers under /home/user/working/crush/internal/repomap/parity_metrics*.go; store metric artifacts under /home/user/working/crush/internal/repomap/testdata/parity_aider/. Acceptance: compute A1 metrics per fixture with Jaccard(top-30) >= 0.85 and Spearman(shared top-30) >= 0.80, include fallback behavior for low shared cardinality, and emit per-fixture metric artifacts consumed by Gate A aggregate. Verification: `go test ./internal/repomap/... -run A1|Parity|Concordance`. Subagent prompt (exact): \"Implement A1 ranking concordance metrics per task and run targeted parity tests.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["218", "225"]}
{"id": "230", "subject": "[P5-A5] Implement determinism check", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate A5 (determinism). Files: modify /home/user/working/crush/internal/repomap/parity_test.go and deterministic helper code under /home/user/working/crush/internal/repomap/parity_determinism*.go. Acceptance: repeated-run checks pass for files/manual modes; parity profile compares comparator-normalized hashes; enhancement profile requires byte-identical raw output; failures are deterministic and artifacted. Verification: `go test ./internal/repomap/... -run A5|Determinism|Parity`. Subagent prompt (exact): \"Implement A5 determinism parity checks and verify both profile paths.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["218", "225"]}
{"id": "231", "subject": "[P5-A2] Implement stage/render fidelity check", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate A2 (stage/render fidelity). Files: modify /home/user/working/crush/internal/repomap/parity_test.go and fixture validators under /home/user/working/crush/internal/repomap/parity_stage*.go; update artifacts under /home/user/working/crush/internal/repomap/testdata/parity_aider/. Acceptance: enforce stage 0/1/2/3 invariants, render fidelity rules, and allowed comparator-normalization behavior with stage-membership trace evidence. Verification: `go test ./internal/repomap/... -run A2|Stage|Render|Parity`. Subagent prompt (exact): \"Implement A2 stage/render parity assertions and verify with fixture tests.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["218", "225"]}
{"id": "232", "subject": "[P5-A3] Implement token safety/accounting check", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate A3 (token safety/accounting). Files: modify /home/user/working/crush/internal/repomap/parity_test.go and token helpers under /home/user/working/crush/internal/repomap/parity_tokens*.go. Acceptance: parity/safety token assertions enforce tokenizer availability, comparator tuple pinning, and profile-scoped budget acceptance; include negative tests for missing tokenizer/provenance. Verification: `go test ./internal/repomap/... -run A3|Token|Safety|Parity`. Subagent prompt (exact): \"Implement A3 token-accounting and safety assertions including negative tests.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["218", "225"]}
{"id": "233", "subject": "[P5-A4] Implement refresh semantics check", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate A4 (refresh semantics). Files: modify /home/user/working/crush/internal/repomap/parity_test.go and refresh helper tests under /home/user/working/crush/internal/repomap/*refresh*_test.go. Acceptance: validate auto/files/manual/always behavior, parity-specific constraints, and prompt-cache coercion behavior with per-mode assertions. Verification: `go test ./internal/repomap/... -run A4|Refresh|Mode|Parity`. Subagent prompt (exact): \"Implement A4 refresh semantics parity tests and run verification.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["218", "225"]}
{"id": "234", "subject": "[P5-B2] Implement disclosure marker parity", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate B2 (disclosure marker parity). Files: modify /home/user/working/crush/internal/lcm/explorer/parity_test.go and /home/user/working/crush/internal/lcm/explorer/formatter*_test.go. Acceptance: parity mode accepts defined truncation marker variants with normalization; enhancement mode enforces canonical markers only; tests cover pass/fail cases. Verification: `go test ./internal/lcm/explorer/... -run B2|Marker|Disclosure|Parity`. Subagent prompt (exact): \"Implement B2 disclosure marker checks and verify variant handling.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["222", "225"]}
{"id": "235", "subject": "[P5-A6] Implement parity leakage guard", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate A6 (parity leakage guard). Files: modify /home/user/working/crush/internal/repomap/parity_test.go and profile metadata helpers under /home/user/working/crush/internal/repomap/parity_profile*.go. Acceptance: parity runs hard-fail when enhancement-only toggles leak; artifact metadata records active toggles; include intentional leakage negative test. Verification: `go test ./internal/repomap/... -run A6|Leakage|Profile|Parity`. Subagent prompt (exact): \"Implement A6 profile-leakage checks and validate fail/pass behavior.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["218", "225"]}
{"id": "236", "subject": "[P5-B1] Implement extraction quality scoring", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate B1 (extraction quality scoring). Files: modify /home/user/working/crush/internal/lcm/explorer/parity_test.go and add/update scoring helpers under /home/user/working/crush/internal/lcm/explorer/parity_scoring*.go. Acceptance: implement micro/macro/per-language scoring with capability-aware denominators; protocol metadata is emitted in artifacts and validated in tests. Verification: `go test ./internal/lcm/explorer/... -run B1|Scoring|Parity`. Subagent prompt (exact): \"Implement B1 scoring protocol and metric aggregation with tests.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["222", "225"]}
{"id": "237", "subject": "[P5-B3] Implement runtime-path matrix checks", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate B3 (runtime-path matrix). Files: modify /home/user/working/crush/internal/lcm/explorer/parity_test.go and inventory validators under /home/user/working/crush/internal/lcm/explorer/parity_inventory*.go; consume /home/user/working/crush/internal/lcm/explorer/testdata/parity_volt/runtime_ingestion_paths.v1.json. Acceptance: enforce persisted/non-persisted matrix, retrieval-scope auth assertions, and fail on inventory drift. Verification: `go test ./internal/lcm/explorer/... -run B3|Runtime|Inventory|Parity`. Subagent prompt (exact): \"Implement B3 runtime-path matrix assertions with inventory drift enforcement.\"", "status": "pending", "blockedBy": ["227", "168", "241"], "blocks": ["222", "225"]}
{"id": "238", "subject": "[P5-B4] Implement data-format depth checks", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate B4 (data-format depth). Files: modify /home/user/working/crush/internal/lcm/explorer/parity_test.go and format metric helpers under /home/user/working/crush/internal/lcm/explorer/parity_format*.go; update fixtures under /home/user/working/crush/internal/lcm/explorer/testdata/parity_volt/. Acceptance: required fields and quality thresholds are enforced for Markdown/LaTeX/SQLite/Logs and existing formats with profile-scoped threshold handling. Verification: `go test ./internal/lcm/explorer/... -run B4|Format|Depth|Parity`. Subagent prompt (exact): \"Implement B4 data-format depth/coverage checks and run verification.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["222", "225"]}
{"id": "239", "subject": "[P5-B5] Implement deterministic E2E parity check", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E Gate B5 (deterministic E2E parity). Files: modify /home/user/working/crush/internal/lcm/explorer/parity_test.go and parity task integration assertions under /home/user/working/crush/internal/lcm/explorer/*parity*_test.go. Acceptance: deterministic E2E parity gate is fail-closed with enhancement tiers disabled and hard-fails on any threshold miss. Verification: `go test ./internal/lcm/explorer/... -run B5|Deterministic|E2E|Parity`. Subagent prompt (exact): \"Implement B5 deterministic end-to-end parity gate checks and verify fail-closed behavior.\"", "status": "pending", "blockedBy": ["227"], "blocks": ["222", "225"]}
{"id": "240", "subject": "[P5-PROV] Validate comparator provenance bundle", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 5E provenance requirements (preflight dependency). Files: add/modify validator helpers in /home/user/working/crush/internal/repomap/parity_provenance*.go and /home/user/working/crush/internal/lcm/explorer/parity_provenance*.go with tests in corresponding *_test.go files. Acceptance: validator hard-fails when required provenance keys are missing/invalid (aider/volt commit SHA, comparator path, fixtures_sha256, tokenizer/grep_ast tuple where required) and is wired into parity harness preflight. Verification: `go test ./internal/repomap/... ./internal/lcm/explorer/... -run Provenance|Bundle|Preflight`. Subagent prompt (exact): \"Implement provenance bundle validator with fail-closed behavior and tests for missing/invalid fields.\"", "status": "pending", "blockedBy": [], "blocks": ["226", "225"]}
{"id": "241", "subject": "[P4-AUTH] Verify retrieval authorization matrix", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 4 auth matrix validation (P4-AUTH split). Files: modify /home/user/working/crush/internal/agent/tools/lcm_describe*_test.go, /home/user/working/crush/internal/agent/tools/lcm_expand*_test.go, and relevant integration tests under /home/user/working/crush/internal/lcm/*_test.go. Acceptance: self+ancestor allowed, unrelated denied; parity_mode=true enforces Volt-strict sub-agent-only expansion; persisted and non-persisted paths are both covered. Verification: `go test ./internal/agent/tools/... ./internal/lcm/... -run Auth|Describe|Expand|Matrix`. Subagent prompt (exact): \"Implement retrieval authorization matrix tests and ensure parity/enhancement mode distinctions are enforced.\"", "status": "pending", "blockedBy": ["192", "167", "169"], "blocks": ["207", "202", "237"]}
{"id": "242", "subject": "[P3-TOOL] Wire map_refresh tool exposure", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 4 controls + tool exposure split (P3-TOOL dependency). Files: modify /home/user/working/crush/internal/agent/tools/map_refresh*.go, /home/user/working/crush/internal/agent/tool*.go, and related tests under /home/user/working/crush/internal/agent/tools/*_test.go and /home/user/working/crush/internal/agent/*_test.go. Acceptance: map_refresh is implemented, registered, and allowlisted with disabled-tools behavior tests; map_reset is not exposed as unrestricted external tool. Verification: `go test ./internal/agent/... ./internal/agent/tools/... -run MapRefresh|Tool|Visibility|Allowlist`. Subagent prompt (exact): \"Implement map_refresh tool exposure end-to-end (implementation, registration, allowlist, tests) and verify behavior.\"", "status": "pending", "blockedBy": [], "blocks": ["202", "201"]}
{"id": "243", "subject": "[P3-RUNKEY] Propagate RunInjectionKey context", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 4 per-run guard dependency (RunInjectionKey propagation split). Files: modify /home/user/working/crush/internal/agent/agent.go and tests under /home/user/working/crush/internal/agent/*run*_test.go and /home/user/working/crush/internal/repomap/*_test.go as needed. Acceptance: RunInjectionKey is attached in Run() from root user message ID + queue generation; queued recursive runs get new keys; tests prove one-injection-per-run behavior. Verification: `go test ./internal/agent/... ./internal/repomap/... -run RunKey|ShouldInject|Guard|Queue`. Subagent prompt (exact): \"Implement RunInjectionKey context propagation in Run path with tests for recursive queue scenarios.\"", "status": "pending", "blockedBy": [], "blocks": ["199", "202"]}
{"id": "244", "subject": "[P3-FILETRACK] Normalize filetracker root semantics", "description": "Repo: /home/user/working/crush. Plan refs: critical file list includes internal/filetracker/service.go normalization requirement. Implement path normalization against configured working dir (cfg.WorkingDir) rather than implicit os.Getwd semantics. Add regression tests for cross-root/path-relativization behavior used by repo-map chat files and mention extraction. Verification: `go test ./internal/filetracker/...` and relevant integration tests. Subagent prompt (exact): \"Implement filetracker path normalization to configured root and add tests for root-consistent behavior.\"", "status": "pending", "blockedBy": [], "blocks": ["202", "197", "178"]}
{"id": "245", "subject": "[P3-LCM] Add RepoMapTokens budget plumbing", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 3/4 LCM integration (RepoMapTokens plumbing). Files: modify /home/user/working/crush/internal/lcm/config.go, /home/user/working/crush/internal/lcm/manager.go, and corresponding tests under /home/user/working/crush/internal/lcm/*_test.go. Acceptance: RepoMapTokens overhead is part of session budget math; SetRepoMapTokens(ctx, sessionID, tokens) atomically updates in-memory and persisted thresholds; tests cover recompute behavior and races. Verification: `go test ./internal/lcm/... -run RepoMapTokens|Budget|Manager`. Subagent prompt (exact): \"Implement RepoMapTokens budget plumbing in LCM config/manager with atomic update semantics and tests.\"", "status": "pending", "blockedBy": [], "blocks": ["202", "198"]}
{"id": "248", "subject": "[P2-CALLSITE] Update NewRegistry call sites", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 2A backward-compatibility for Registry options. Files: update call sites in /home/user/working/crush/internal/lcm/explorer/*.go and tests across /home/user/working/crush/internal/** where NewRegistry/NewRegistryWithLLM are used (including production + test call paths). Acceptance: all call sites compile with opts variadics, behavior remains unchanged for no-option paths, and smoke coverage proves compatibility. Verification: `go test ./internal/lcm/explorer/... ./internal/... -run Registry|NewRegistry|Compile`. Subagent prompt (exact): \"Update all NewRegistry/NewRegistryWithLLM call sites for the new options signatures and verify no behavior regressions.\"", "status": "pending", "blockedBy": ["147", "255"], "blocks": ["170"]}
{"id": "249", "subject": "[P3-GATE0] Verify Phase 3A.0 gate", "description": "Gate task. Repo: /home/user/working/crush. Plan refs: Phase 3A.0 gate. Files: no planned source edits; if needed, only /home/user/working/crush/internal/repomap/vertical_slice_test.go and related /home/user/working/crush/internal/repomap/*_test.go. Acceptance: non-empty output, budget semantics by profile, determinism, and stage invariants all passing. Verification: `go test ./internal/repomap/... -run VerticalSlice|Budget|Determinism|Stage`. Subagent prompt (exact): \"Execute Phase 3A.0 gate checks and fix only 3A.0 test failures.\"", "status": "pending", "blockedBy": ["171", "173", "174", "250"], "blocks": ["254", "192", "228"]}
{"id": "250", "subject": "[P3-00] Build 3A.0 fixture harness", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 3A.0. Build the vertical-slice fixture harness for `extract -> graph -> rank -> render -> budget-fit`. Files: create/update internal/repomap/vertical_slice_test.go and internal/repomap/testdata/vertical_slice/* fixtures. Harness must run both profiles (`parity_mode=true|false`) and emit enough data for downstream budget/determinism/stage-invariant assertions. Verification: `go test ./internal/repomap/... -run VerticalSlice`. Delegation prompt (exact): \"Read this task only. Implement the 3A.0 fixture harness in the specified files, then run the listed verification command and report changed files + test output.\"", "status": "pending", "blockedBy": ["144", "147"], "blocks": ["249", "171", "174", "173"]}
{"id": "251", "subject": "[P5-08] Implement tsaudit check", "description": "Repo: /home/user/working/crush. Phase 5C tsaudit check command. Implement `check` in internal/cmd/tsaudit (main + command files) to detect drift between Aider primary/fallback query sources and internal/treesitter/languages.json + vendored queries. Add unit tests for core comparison logic. Required verification: `go run ./internal/cmd/tsaudit check` and `go test ./internal/cmd/tsaudit/...` (if tests exist). Subagent execution prompt (exact): \"Implement tsaudit check command + tests per TODO and provide command/test outputs.\"", "status": "pending", "blockedBy": ["141"], "blocks": ["214", "215", "225"]}
{"id": "253", "subject": "[P2-01] Implement TreeSitterExplorer", "description": "Repo: /home/user/working/crush. Spec: Phase 2A. Create internal/lcm/explorer/code_treesitter.go implementing TreeSitterExplorer{parser treesitter.Parser} with CanHandle() requiring SupportsLanguage+HasTags for parity path and Explore() calling parser.Analyze() with size guard behavior (MaxFullLoadSize contract). Ensure enhanced capture support remains in parser/query layer; explorer should consume analysis and format via existing explorer result patterns. Verification: `go test ./internal/lcm/explorer/...`. Subagent prompt: 'Implement TreeSitterExplorer and integrate compile-safe with existing explorer interfaces; do not perform runtime wiring yet.'", "status": "pending", "blockedBy": ["147"], "blocks": ["164", "160", "170", "255"]}
{"id": "254", "subject": "[P3-11] Implement repomap service core", "description": "Repo: /home/user/working/crush. Plan refs: Phase 3A.1 repomap.go API contract. Implement Service core in internal/repomap/repomap.go: NewService, Generate, Available, AllFiles, LastGoodMap, LastTokenCount, ShouldInject, RefreshAsync, Refresh, Reset, PreIndex, Close, plus RunInjectionKey and GenerateOpts structs with fields from plan. Add concurrency-safe state and lifecycle context handling. Verification: `go test ./internal/repomap/...`. Delegation prompt (exact): \"Implement repomap Service API surface exactly per task contract, compile and run tests, then report changed files.\"", "status": "pending", "blockedBy": ["249"], "blocks": ["178", "185", "192", "199"]}
{"id": "255", "subject": "[P2-02] Wire registry parser injection", "description": "Repo: /home/user/working/crush. Plan refs: docs/PLAN-treesitter-repomap.md Phase 2A registry parser injection. Files: modify /home/user/working/crush/internal/lcm/explorer/explorer.go and related tests under /home/user/working/crush/internal/lcm/explorer/*_test.go; update any impacted constructor call sites in /home/user/working/crush/internal/lcm/explorer/ and /home/user/working/crush/internal/lcm/. Acceptance: RegistryOption/WithTreeSitter(parser) and variadic opts pass-through are implemented for NewRegistry and NewRegistryWithLLM with backward compatibility preserved. Verification: `go test ./internal/lcm/explorer/... ./internal/lcm/... -run Registry|WithTreeSitter|Constructor`. Subagent prompt (exact): \"Implement functional options for registry and LLM constructor pass-through with minimal churn and compatibility.\"", "status": "pending", "blockedBy": ["147", "253"], "blocks": ["248", "158", "170"]}